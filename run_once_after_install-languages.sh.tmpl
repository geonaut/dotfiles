#!/bin/bash

# Check the variable from .chezmoi.toml
{{ if .install_languages -}}
echo "ğŸš€ Opt-in: Installing programming languages..."

# 2a. Rustup
if ! command -v rustup >/dev/null 2>&1; then
    echo "ğŸ¦€ Installing Rustup..."
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y &> /dev/null
fi

# 2b. Pyenv
if command -v pyenv >/dev/null 2>&1; then
    echo "ğŸ Setting up Python via pyenv..."
    # Ensure shims are available for the current script
    eval "$(pyenv init --path)"
    if ! pyenv versions --bare | grep -q "3.10"; then
        pyenv install 3.10.13
        pyenv global 3.10.13
    fi
    pyenv versions
fi

# --- Go 1.24 via goenv ---
if ! goenv versions | grep -q "1.24"; then
    echo "ğŸ¹ Installing Go 1.24.0..."
    goenv install 1.24.0
    goenv global 1.24.0
else
    goenv versions
    echo "âœ… Go 1.24 is already installed."
fi

echo "âœ… Language managers initialized."

{{ else -}}
echo "â­ï¸ Skipping language installation as per config."
{{ end -}}
